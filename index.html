<!DOCTYPE html>
<html>
<head>
	<title>Parties</title>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="tachyons.min.css">
	<link rel="stylesheet" type="text/css" href="master.css">
	<link rel="shortcut icon" href="https://whotargets.me/wp-content/uploads/2017/04/logo-small-3.png" />
	<style>
	@media screen and (min-width: 1180px) {
		#constituencies svg {
			margin-left: 70px;
		}
	}
	/*.leave:after {
		content: ": leaver"
	}*/
	.leave {
		background: lightblue;
	}
	/*.remain:after {
		content: ": remainer"
	}*/
	.remain {
		background: yellow;
	}
	</style>
</head>
<body class='pv5'>
	<div id='loading' class='measure center tc' style="width: 400px">
		<div class='pv6 dotdotdot f3 lh-title poppins b mb3 tc'>One sec</div>
	</div>
	<main id='app' style='display: none;'>
		<header style='max-width: 1140px;' class='center ph3 pv4'>
			<a class='b f3 poppins dib fr mt2' href='categoriser.html'>Advertiser categoriser</a>
			<div class='b f2 poppins'>Extension coverage</div>
		</header>
		<section style='max-width: 1180px; min-height: 400px;' class='center bg-light-gray'>
			<div style='max-width: 1140px;' class='center ph3 pv4 '>
				<div class='w-100'>
					<div class='fl w-50'>
						<div class='f2 b mt1 mb0 center mid-gray poppins' v-if='demographics.gender'>{{userCount|d}} users</div>
						<div class='f4 mt0 gray'>
							<span v-for='(d,gender) in demographics.gender'>{{d.count|d}} <span class='f6'>({{d.count/(userCount)|%}})</span> {{gender == 0 ? "other" : gender == 1 ? "male" : "female"}}s&nbsp;&nbsp;&nbsp;</span>
						</div>
						<div class='f4 mt0 gray'>{{avgAge|d(0)}} average age</div>
						<div class='z-0 relative' id='age'></div>
					</div>
					<div id='map' class='fr w-50 relative'>
						<div v-if='mapGenerated' class='f3 b mid-gray poppins tr mt2'>Users in <span class='f2'>{{list.filter((o)=>o.properties.users > 0).length}}</span>/{{list.length}} constituencies</div>
						<div class='relative gray'>
							<div class='relative' id='constituencies'><svg></svg></div>
							<div class='tr absolute top-2 right-0'>
								<div class='f7'>
									<div class='b'>Colour scheme</div>
									<label class='pointer'>
										> 0 users&nbsp;<input class='pointer' v-model='threshold' name='threshold' type='radio' value='0.1' />
									</label>
									<br>
									<label class='pointer'>
										> 10 users&nbsp;<input class='pointer' v-model='threshold' name='threshold' type='radio' value='10' />
									</label>
									<br>
									<label class='pointer'>
										Least to Most users (full range)&nbsp;<input class='pointer' v-model='threshold' name='threshold' type='radio' :value='maxdownloads' />
									</label>
									<br>
									<label class='pointer'>
										Proportion of electorate&nbsp;<input class='pointer' v-model='threshold' name='threshold' type='radio' value='coverage' />
									</label>
									<br>
									<br>
									<div class='b'>Options</div>
									<label class='pointer'>
										Highlight no users&nbsp;<input class='pointer' v-model='showEmpty' name='showEmpty' type='checkbox' />
									</label>
								</div>
								<div v-if='mapGenerated && selectedConstituency' class='mid-gray'>
									<hr>
									<div class='f5 b'>{{typeof selectedConstituency === 'string' ? selectedConstituency : selectedConstituency.name}}</div>
									<div class='f5'><b>{{typeof selectedConstituency === 'string' ? 0 : selectedConstituency.users|d}}</b> volunteers</div>
									<div class='f5'>{{selectedConstituency.electorate|d}} electorate, <b>{{selectedConstituency.coverage|%(4)}}</b> coverage</div>
									<br>
									<div class='f7 fl w-30 tl gray b'>2015 GE</div>
									<div class='f5 fr w-70'>
										<div class='f5'><span class='f7 b lh-copy ph1 dib v-mid br2 white bg-gray' :class='"party-"+selectedConstituency.first_party.id'>{{selectedConstituency.first_party.short_name}}</span> <b>{{selectedConstituency.first_party.share|%}}</b></div>
										<div class='f5'><span class='f7 b lh-copy ph1 dib v-mid br2 white bg-gray' :class='"party-"+selectedConstituency.second_party.id'>{{selectedConstituency.second_party.short_name}}</span> <b>{{selectedConstituency.second_party.share|%}}</b></div>
									</div>
									<div class='cf'></div>
									<!-- <div class='f7 fl w-40 tl gray b'></div>
									<div class='f7 fl w-30 tl gray b'>2016 BREXIT</div>
									<div class='f6 fr w-30'>
										<span class='tc pa1' class='bg-gray' :class='{leave: selectedConstituency.brexit > 0.5, remain: selectedConstituency.brexit < 0.5}'><b>{{selectedConstituency.brexit|%(1)}}</b> Brexit vote</span>
									</div>
									<div class='cf'></div> -->
								</div>
							</div>
							<span class='tr absolute bottom-0 right-0 f7 gray'>Map courtesy of <a class='pointer gray' href='https://github.com/guardian/interactive-uk-cartogram-2015'><i>The Guardian</i> on Github</a></span>
						</div>
					</div>
				</div>
				<div class='cf'></div>
			</div>
		</section>
		<div style='max-width: 1140px;' class='center ph3 pv4'>
			<div class='center w-50 fl' v-for='(rank,rankName) in coverageByParty'>
				<div class='f5 b tc poppins'>Coverage by constituency's {{rankName=='first_party' ? "first" : "second"}} party</div>
				<br>
				<table v-if='coverageByParty'>
					<tr v-for='party in rank'>
						<td class='tr'><span :class='"party-"+party.id' class='f7 b lh-copy ph1 dib v-mid br2 white bg-gray'>{{party.short_name}}</span></td>
						<td><b>{{party.volunteers|d}}</b> volunteers</td>
						<td><b>{{party.coverage|%(4)}}</b></td>
						<td>of <b>{{party.electorate|d}}</b> {{rankName=='first_party' ? "controlled" : "contested"}} pax</td>
					</tr>
				</table>
			</div>
			<div class='cf'></div>
			<br><br>
			<hr>
			<br>
			<h3 class='poppins tc'>Constituency party coverage</h3>
			<!-- <label class='pointer'>
				Order by coverage&nbsp;<input class='pointer' v-model='orderBy' name='orderBy' type='radio' value='coverage' />
			</label>
			<br>
			<label class='pointer'>
				Order by first party share&nbsp;<input class='pointer' v-model='orderBy' name='orderBy' type='radio' value='partyShare' />
			</label>
			<br> -->
			<table class='tc center f6' v-if='list.length > 0' v-once>
				<tr v-for='hex in list'>
					<td class='tr b' :class="{'red':hex.users == 0 }">{{hex.properties.name}}</td>
					<td><span class='b f5' :class="{'red':hex.properties.users == 0 }">{{hex.properties.users|d}}</span> volunteers &nbsp;-</td>
					<td :class="{'red':hex.properties.users == 0 }" class='b'>{{hex.properties.coverage|%(4)}}</td>
					<td class='tl'>of {{hex.properties.electorate|d}} electorate</td>
					<td class='tl'>2015: <b>{{hex.properties.first_party.share|%}}</b> <span class='f7 b lh-copy ph1 dib v-mid br2 white bg-gray' :class='"party-"+hex.properties.first_party.id'>{{hex.properties.first_party.short_name}}</span></td>
					<td class='tl'><b>{{hex.properties.second_party.share|%}}</b> <span class='f7 b lh-copy ph1 dib v-mid br2 white bg-gray' :class='"party-"+hex.properties.second_party.id'>{{hex.properties.second_party.short_name}}</span></td>
					<td class='tc pa1' class='bg-gray' :class='{leave: hex.properties.brexit > 0.5, remain: hex.properties.brexit < 0.5}'><b>{{hex.properties.brexit|%(1)}}</b> Brexit vote</td>
				</tr>
			</table>
		</div>
	</main>

	<script src="https://unpkg.com/topojson@3"></script>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.30/vega.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.0-beta.2/vega-lite.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.14/vega-embed.js"></script>
	<script src="vue.min.js"></script>
	<script src="jquery-3.2.1.min.js"></script>
	<script src="view.stats.js"></script>
</body>
</html>
